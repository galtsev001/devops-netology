## 12.3 Развертывание кластера на собственных серверах, лекция 1

#### Задание 1: Описать требования к кластеру

Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

**Ответ:**

+ Расчет необходимых ресурсов

| Компоненты  | CPU                          | ОЗУ                 |
|:---         |:---                          |:---                 |
| База Данных | 1 * 3 = 3 ядра               | 4 * 3 = 12 Гб       |     
| Кэш         | 1 * 3 = 3 ядра               | 4 * 3 = 12 Гб       | 
| FrontEnd    | 0,2 * 5 = 1 ядро             | 0,05 * 5 = 0,25 Гб  | 
| BackEnd     | 1 * 10 = 10 ядер             | 0,6 * 10 = 6 Гб     | 
| **Итого**   | **17 ядер**                  |  **31 Гб**          | 

+ Выберем число рабочих нод для распределения нагрузки.

Для разработки стратегии и развития бизнеса, необходимо предоставить несколько вариантов архитектуры со всеми плюсами и минусами.
Предлагаю сделать расчеты для 3, 4 и 5 рабочих нод. Меньше 3х нодов делать рискованно, более пяти нод под требования будут считаться избыточными.
В целях отказоустойчивости необходимо три Control Plane ноды.

|       | 3 Control Plane-nodes |
|:---   |:---                   |
| CPU   | 2 cpu * 3 шт. = 6     |
| ОЗУ   | 2 cpu * 3 шт. = 6     |

Worker-nodes:

|       | 3 ноды       | 4 ноды       | 5 нод            |
|:---   |:---          |:---          | :---             |
| CPU   | 17 + 3 = 20  | 17 + 4 = 21  | 17 + 5 = 22 ядра |    
| ОЗУ   | 31 + 3 = 34  | 31 + 4 = 35  | 31 + 5 = 36 Гб   |

+ Расчет для запаса системы отказоустойчивости

|       | 3 ноды           | 4 ноды            | 5 нод          |
|:---   |:---                       |:---                       | :---                     |
| CPU   | (17 * 1,33) + 3 = 26 ядер | (17 * 1,25) + 4 = 26 ядер | (17 * 1,2) + 5 = 26 ядер |    
| ОЗУ   | (31 * 1,33) + 3 = 45 Гб   | (31 * 1,25) + 4 = 43 Гб   | (31 * 1,2) + 5 = 43 Гб   |

+ Считаем требования к ресурсам на каждую Worker-ноду:

|       | 3 ноды  | 4 ноды  | 5 нод  |
|:---   |:---             |:---             | :---            |
| CPU   | 26 / 3 = 9 ядер | 26 / 7 = 7 ядер | 26 / 5 = 6 ядер |    
| ОЗУ   | 45 / 3 - 15 Гб  | 43 / 4 = 11 Гб  | 43 / 5 = 9 Гб   |

+ **Итоги**
    + 5 Worker-нод: По 6 ядер и 9 Гб на одну ноду
    + Общее кол-во ресурсов 36 CPU и 51 Гб ОЗУ